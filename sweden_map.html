<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sweden Map</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        .map-container {
            display: flex;
            gap: 30px;
            align-items: flex-start;
            justify-content: center;
        }
        
        .map-wrapper {
            position: relative;
            display: inline-block;
        }
        
        #sweden-map {
            width: 800px;
            height: auto;
            border: 2px solid #333;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .data-panel {
            min-width: 400px;
            max-width: 400px;
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #ddd;
            max-height: 800px;
            overflow-y: auto;
        }
        
        .data-panel h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007acc;
            padding-bottom: 10px;
        }
        
        .city-list {
            margin-bottom: 20px;
        }
        
        .city-item {
            background: white;
            margin-bottom: 10px;
            padding: 12px;
            border-radius: 5px;
            border-left: 4px solid #FF5722;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .city-item:hover {
            background: #f0f0f0;
            transform: translateX(5px);
        }
        
        .city-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 4px;
        }
        
        .city-details {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }
        
        .coordinates {
            font-family: monospace;
            background: #e8e8e8;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .toggle-info {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #007acc;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            font-size: 14px;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .toggle-info:hover {
            background: #005a9e;
            transform: translateY(-2px);
        }
        
        .debug-info {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 12px;
            max-width: 300px;
            display: none;
            z-index: 1001;
        }
        
        .debug-info.show {
            display: block;
        }
        
        .map-placeholder {
            width: 600px;
            height: 800px;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 2px solid #333;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: #333;
            font-size: 18px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .city-marker {
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .city-marker:hover {
            transform: scale(1.5);
            background: #D32F2F !important;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5) !important;
        }
        
        .city-markers {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .city-markers .city-marker {
            pointer-events: all;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            display: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Sweden Map</h1>
        <div class="map-container">
            <div class="map-wrapper">
                <!-- Sweden SVG Map from SimpleMaps -->
                <div style="position: relative; display: inline-block;">
                    <img id="sweden-map" 
                         src="https://simplemaps.com/static/svg/country/se/admin1/se.svg" 
                         alt="Sweden Map" 
                         style="width: 800px; height: auto; border: 2px solid #333; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
                    
                    <!-- City markers will be dynamically generated here -->
                </div>
            </div>
            
            <div class="data-panel">
                <h3>Swedish Cities Data</h3>
                <div class="city-list" id="city-list">
                    <!-- City data will be populated here -->
                </div>
                
                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                    <h4 style="margin: 0 0 10px 0; color: #666;">Map Statistics</h4>
                    <div style="font-size: 12px; color: #888;">
                        <div>Total Cities: <span id="city-count">0</span></div>
                        <div>Map Bounds: 55.0Â°N - 69.5Â°N, 10.5Â°E - 24.5Â°E</div>
                        <div>Source: <a href="https://simplemaps.com/static/svg/country/se/admin1/se.svg" target="_blank">SimpleMaps</a></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toggle button for debug info -->
    <button class="toggle-info" onclick="toggleDebugInfo()">
        ðŸ”§ Debug Info
    </button>
    
    <!-- Debug info panel -->
    <div class="debug-info" id="debug-info">
        <h4 style="margin: 0 0 10px 0;">Debug Information</h4>
        <p><strong>Current Status:</strong> GPS Calibration Mode</p>
        <p><strong>Features:</strong></p>
        <ul style="margin: 5px 0; padding-left: 15px; font-size: 11px;">
            <li>GPS coordinate-based positioning</li>
            <li>Calibration markers (Red=N, Green=S, Blue=W, Yellow=E)</li>
            <li>Console logging for debugging</li>
            <li>Population-based marker sizing</li>
        </ul>
        <p><strong>Instructions:</strong></p>
        <ul style="margin: 5px 0; padding-left: 15px; font-size: 11px;">
            <li>Open browser console (F12) for coordinate logs</li>
            <li>Check calibration markers align with map edges</li>
            <li>Hover cities for GPS coordinates</li>
        </ul>
    </div>
    
    <div class="tooltip" id="tooltip"></div>

    <script>
        // Sweden geographic bounds - adjusted for SimpleMaps SVG
        // These may need fine-tuning based on the actual SVG projection
        const SWEDEN_BOUNDS = {
            north: 69.5,    // Slightly extended north
            south: 55.5,    // Slightly extended south
            west: 3,     // Slightly extended west  
            east: 32.5      // Slightly extended east
        };
        
        // Padding to account for SVG margins/borders
        const MAP_PADDING = {
            top: 0.05,      // 5% padding from top
            bottom: 0.05,   // 5% padding from bottom
            left: 0.05,     // 5% padding from left
            right: 0.05     // 5% padding from right
        };
        
        // Map dimensions (adjust based on actual rendered size)
        const MAP_WIDTH = 400;
        const MAP_HEIGHT = 600; // Will be calculated based on aspect ratio
        
        // City data with real GPS coordinates
        const cityData = {
            Stockholm: { 
                lat: 59.3293, 
                lng: 18.0686, 
                population: "975,551", 
                region: "Stockholm County" 
            },
            Gothenburg: { 
                lat: 57.7089, 
                lng: 11.9746, 
                population: "579,281", 
                region: "VÃ¤stra GÃ¶taland County" 
            },
            MalmÃ¶: { 
                lat: 55.6050, 
                lng: 13.0038, 
                population: "347,949", 
                region: "SkÃ¥ne County" 
            },
            Uppsala: { 
                lat: 59.8586, 
                lng: 17.6389, 
                population: "230,767", 
                region: "Uppsala County" 
            },
            Ã–rebro: { 
                lat: 59.2741, 
                lng: 15.2066, 
                population: "126,009", 
                region: "Ã–rebro County" 
            }
        };
        
        // Convert GPS coordinates to map pixel coordinates
        function gpsToMapCoordinates(lat, lng, mapImg) {
            const mapRect = mapImg.getBoundingClientRect();
            const mapWidth = mapRect.width;
            const mapHeight = mapRect.height;
            
            // Calculate relative position within Sweden's bounds
            const latRange = SWEDEN_BOUNDS.north - SWEDEN_BOUNDS.south;
            const lngRange = SWEDEN_BOUNDS.east - SWEDEN_BOUNDS.west;
            
            // Normalize coordinates (0 to 1)
            let latPercent = (SWEDEN_BOUNDS.north - lat) / latRange;
            let lngPercent = (lng - SWEDEN_BOUNDS.west) / lngRange;
            
            // Apply padding to account for SVG margins
            const usableWidth = mapWidth * (1 - MAP_PADDING.left - MAP_PADDING.right);
            const usableHeight = mapHeight * (1 - MAP_PADDING.top - MAP_PADDING.bottom);
            
            // Convert to pixel coordinates with padding
            const x = (MAP_PADDING.left * mapWidth) + (lngPercent * usableWidth);
            const y = (MAP_PADDING.top * mapHeight) + (latPercent * usableHeight);
            
            // Debug logging
            console.log(`${lat}, ${lng} -> ${x.toFixed(1)}, ${y.toFixed(1)} (${latPercent.toFixed(3)}, ${lngPercent.toFixed(3)})`);
            
            // Clamp coordinates to map bounds
            const clampedX = Math.max(0, Math.min(mapWidth, x));
            const clampedY = Math.max(0, Math.min(mapHeight, y));
            
            return { x: clampedX, y: clampedY };
        }
        
        // Create city marker element
        function createCityMarker(cityName, cityInfo, position) {
            const marker = document.createElement('div');
            marker.className = 'city-marker';
            marker.setAttribute('data-city', cityName);
            
            // Size based on population (larger cities get bigger markers)
            const population = parseInt(cityInfo.population.replace(/,/g, ''));
            let size = 6;
            if (population > 500000) size = 12;
            else if (population > 200000) size = 10;
            else if (population > 100000) size = 8;
            
            marker.style.cssText = `
                position: absolute;
                left: ${position.x - size/2}px;
                top: ${position.y - size/2}px;
                width: ${size}px;
                height: ${size}px;
                background: #FF5722;
                border-radius: 50%;
                cursor: pointer;
                border: 2px solid white;
                box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                z-index: 10;
                transition: all 0.3s ease;
            `;
            
            // Add event listeners
            marker.addEventListener('mouseenter', showTooltip);
            marker.addEventListener('mouseleave', hideTooltip);
            marker.addEventListener('mousemove', moveTooltip);
            marker.addEventListener('click', showCityInfo);
            
            return marker;
        }
        
        // Add calibration markers for debugging
        function addCalibrationMarkers(mapWrapper, mapImg) {
            // Add markers at known extreme points to help calibrate
            const calibrationPoints = [
                { name: "North", lat: 69.1, lng: 18.0, color: "#FF0000" },
                { name: "South", lat: 55.3, lng: 13.0, color: "#00FF00" },
                { name: "West", lat: 62.0, lng: 11.0, color: "#0000FF" },
                { name: "East", lat: 62.0, lng: 24.2, color: "#FFFF00" }
            ];
            
            calibrationPoints.forEach(point => {
                const position = gpsToMapCoordinates(point.lat, point.lng, mapImg);
                const marker = document.createElement('div');
                marker.style.cssText = `
                    position: absolute;
                    left: ${position.x - 3}px;
                    top: ${position.y - 3}px;
                    width: 6px;
                    height: 6px;
                    background: ${point.color};
                    border-radius: 50%;
                    border: 1px solid black;
                    z-index: 15;
                `;
                marker.title = `${point.name}: ${point.lat}, ${point.lng}`;
                mapWrapper.appendChild(marker);
            });
        }
        
        // Initialize map functionality
        function initializeMap() {
            const mapImg = document.getElementById('sweden-map');
            const mapWrapper = mapImg.parentElement;
            
            // Wait for image to load
            mapImg.onload = function() {
                console.log('Map loaded, dimensions:', mapImg.getBoundingClientRect());
                
                // Clear existing markers
                const existingMarkers = mapWrapper.querySelectorAll('.city-marker, [title*="North"], [title*="South"], [title*="West"], [title*="East"]');
                existingMarkers.forEach(marker => marker.remove());
                
                // Add calibration markers for debugging
                addCalibrationMarkers(mapWrapper, mapImg);
                
                // Create markers for each city
                Object.entries(cityData).forEach(([cityName, cityInfo]) => {
                    const position = gpsToMapCoordinates(cityInfo.lat, cityInfo.lng, mapImg);
                    const marker = createCityMarker(cityName, cityInfo, position);
                    mapWrapper.appendChild(marker);
                });
                
                // Populate city data panel
                populateCityDataPanel();
                
                console.log('Sweden map initialized with GPS-positioned city markers');
            };
            
            // If image is already loaded
            if (mapImg.complete) {
                mapImg.onload();
            }
        }
        
        // Populate the city data panel
        function populateCityDataPanel() {
            const cityList = document.getElementById('city-list');
            const cityCount = document.getElementById('city-count');
            
            cityList.innerHTML = '';
            
            // Sort cities by population (largest first)
            const sortedCities = Object.entries(cityData).sort((a, b) => {
                const popA = parseInt(a[1].population.replace(/,/g, ''));
                const popB = parseInt(b[1].population.replace(/,/g, ''));
                return popB - popA;
            });
            
            sortedCities.forEach(([cityName, cityInfo]) => {
                const cityItem = document.createElement('div');
                cityItem.className = 'city-item';
                cityItem.setAttribute('data-city', cityName);
                
                cityItem.innerHTML = `
                    <div class="city-name">${cityName}</div>
                    <div class="city-details">
                        <div>Population: ${cityInfo.population}</div>
                        <div>Region: ${cityInfo.region}</div>
                        <div>GPS: <span class="coordinates">${cityInfo.lat}Â°N, ${cityInfo.lng}Â°E</span></div>
                    </div>
                `;
                
                // Add click event to highlight city on map
                cityItem.addEventListener('click', () => highlightCity(cityName));
                
                cityList.appendChild(cityItem);
            });
            
            // Update city count
            cityCount.textContent = Object.keys(cityData).length;
        }
        
        // Highlight a city on the map
        function highlightCity(cityName) {
            // Remove existing highlights
            document.querySelectorAll('.city-marker').forEach(marker => {
                marker.style.transform = '';
                marker.style.boxShadow = '0 2px 4px rgba(0,0,0,0.3)';
            });
            
            // Remove existing city item highlights
            document.querySelectorAll('.city-item').forEach(item => {
                item.style.background = 'white';
            });
            
            // Highlight the selected city marker
            const cityMarker = document.querySelector(`.city-marker[data-city="${cityName}"]`);
            if (cityMarker) {
                cityMarker.style.transform = 'scale(1.5)';
                cityMarker.style.boxShadow = '0 4px 12px rgba(255, 87, 34, 0.6)';
            }
            
            // Highlight the selected city item
            const cityItem = document.querySelector(`.city-item[data-city="${cityName}"]`);
            if (cityItem) {
                cityItem.style.background = '#e3f2fd';
            }
            
            // Show city info
            const city = cityData[cityName];
            if (city) {
                console.log(`Selected: ${cityName} (${city.lat}Â°N, ${city.lng}Â°E)`);
            }
        }
        
        // Toggle debug info panel
        function toggleDebugInfo() {
            const debugInfo = document.getElementById('debug-info');
            debugInfo.classList.toggle('show');
        }
        
        // Tooltip functions
        function showTooltip(event) {
            const cityName = event.target.getAttribute('data-city');
            const city = cityData[cityName];
            const tooltip = document.getElementById('tooltip');
            
            if (city) {
                tooltip.innerHTML = `
                    <strong>${cityName}</strong><br>
                    Population: ${city.population}<br>
                    Region: ${city.region}<br>
                    <small>Lat: ${city.lat}Â°, Lng: ${city.lng}Â°</small>
                `;
            } else {
                tooltip.textContent = cityName;
            }
            
            tooltip.style.display = 'block';
            moveTooltip(event);
        }
        
        function hideTooltip() {
            document.getElementById('tooltip').style.display = 'none';
        }
        
        function moveTooltip(event) {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.left = (event.pageX + 10) + 'px';
            tooltip.style.top = (event.pageY - 30) + 'px';
        }
        
        function showCityInfo(event) {
            const cityName = event.target.getAttribute('data-city');
            const city = cityData[cityName];
            
            if (city) {
                alert(`${cityName}\n\nPopulation: ${city.population}\nRegion: ${city.region}\nCoordinates: ${city.lat}Â°N, ${city.lng}Â°E\n\nClick OK to continue exploring the map.`);
            }
        }
        
        // Recalculate positions on window resize
        window.addEventListener('resize', initializeMap);
        
        // Initialize when page loads
        window.addEventListener('load', initializeMap);
    </script>
</body>
</html>